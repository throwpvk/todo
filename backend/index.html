<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Todo API Test Suite</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        background: white;
        border-radius: 12px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        overflow: hidden;
      }

      header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        text-align: center;
      }

      header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
      }

      header p {
        opacity: 0.9;
        font-size: 1.1em;
      }

      .main-content {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        padding: 30px;
      }

      .section {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 25px;
        border: 1px solid #e0e0e0;
      }

      .section h2 {
        color: #667eea;
        margin-bottom: 20px;
        font-size: 1.5em;
        border-bottom: 2px solid #667eea;
        padding-bottom: 10px;
      }

      .api-group {
        margin-bottom: 25px;
      }

      .api-group h3 {
        color: #444;
        margin-bottom: 12px;
        font-size: 1.1em;
      }

      .form-group {
        margin-bottom: 15px;
      }

      label {
        display: block;
        margin-bottom: 5px;
        color: #555;
        font-weight: 600;
      }

      input[type="text"],
      input[type="number"],
      textarea,
      select {
        width: 100%;
        padding: 10px;
        border: 2px solid #ddd;
        border-radius: 6px;
        font-size: 14px;
        transition: border-color 0.3s;
      }

      input:focus,
      textarea:focus,
      select:focus {
        outline: none;
        border-color: #667eea;
      }

      textarea {
        min-height: 80px;
        font-family: "Courier New", monospace;
        resize: vertical;
      }

      .checkbox-group {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      input[type="checkbox"] {
        width: 20px;
        height: 20px;
        cursor: pointer;
      }

      button {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: transform 0.2s, box-shadow 0.2s;
        width: 100%;
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      }

      button:active {
        transform: translateY(0);
      }

      .btn-danger {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      }

      .btn-warning {
        background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
      }

      .btn-info {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      }

      #response {
        background: #1e1e1e;
        color: #d4d4d4;
        padding: 20px;
        border-radius: 8px;
        font-family: "Courier New", monospace;
        font-size: 13px;
        line-height: 1.6;
        max-height: 600px;
        overflow-y: auto;
        white-space: pre-wrap;
        word-wrap: break-word;
      }

      .response-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .clear-btn {
        padding: 8px 16px;
        font-size: 12px;
        width: auto;
        background: #444;
      }

      .todo-item {
        background: white;
        padding: 15px;
        margin-bottom: 10px;
        border-radius: 6px;
        border-left: 4px solid #667eea;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .todo-item.completed {
        opacity: 0.6;
        border-left-color: #28a745;
      }

      .todo-text {
        flex: 1;
      }

      .todo-actions {
        display: flex;
        gap: 8px;
      }

      .todo-actions button {
        width: auto;
        padding: 6px 12px;
        font-size: 12px;
      }

      #todoList {
        max-height: 400px;
        overflow-y: auto;
      }

      .status-badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 600;
        margin-left: 10px;
      }

      .status-success {
        background: #d4edda;
        color: #155724;
      }

      .status-error {
        background: #f8d7da;
        color: #721c24;
      }

      .full-width {
        grid-column: 1 / -1;
      }

      .url-display {
        background: #fff3cd;
        padding: 10px;
        border-radius: 6px;
        font-family: "Courier New", monospace;
        font-size: 12px;
        margin-bottom: 10px;
        word-break: break-all;
      }

      @media (max-width: 1024px) {
        .main-content {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>üöÄ Todo API Test Suite</h1>
        <p>Professional API Testing Interface - Full CRUD Operations</p>
      </header>

      <div class="main-content">
        <div class="section">
          <h2>üìã Todo List Manager</h2>

          <div class="api-group">
            <h3>Get All Todos</h3>
            <button onclick="getAllTodos()">üì• Fetch All Todos</button>
          </div>

          <div class="api-group">
            <h3>Get Todo by ID</h3>
            <div class="form-group">
              <label>Todo ID:</label>
              <input type="number" id="getTodoId" placeholder="Enter todo ID" />
            </div>
            <button onclick="getTodoById()">üîç Get Todo</button>
          </div>

          <div class="api-group">
            <h3>Create New Todo</h3>
            <div class="form-group">
              <label>Todo Text:</label>
              <input
                type="text"
                id="createText"
                placeholder="Enter todo text"
              />
            </div>
            <div class="form-group">
              <div class="checkbox-group">
                <input type="checkbox" id="createCompleted" />
                <label for="createCompleted">Completed</label>
              </div>
            </div>
            <button onclick="createTodo()">‚ûï Create Todo</button>
          </div>

          <div id="todoList"></div>
        </div>

        <div class="section">
          <h2>‚úèÔ∏è Update & Delete Operations</h2>

          <div class="api-group">
            <h3>Full Update (PUT)</h3>
            <div class="form-group">
              <label>Todo ID:</label>
              <input type="number" id="putId" placeholder="Enter todo ID" />
            </div>
            <div class="form-group">
              <label>New Text:</label>
              <input type="text" id="putText" placeholder="Enter new text" />
            </div>
            <div class="form-group">
              <label>Completed:</label>
              <select id="putCompleted">
                <option value="true">Completed</option>
                <option value="false">Pending</option>
              </select>
            </div>
            <button class="btn-warning" onclick="updateTodoFull()">
              üîÑ Full Update
            </button>
          </div>

          <div class="api-group">
            <h3>Partial Update (PATCH)</h3>
            <div class="form-group">
              <label>Todo ID:</label>
              <input type="number" id="patchId" placeholder="Enter todo ID" />
            </div>
            <div class="form-group">
              <div class="checkbox-group">
                <input type="checkbox" id="patchTextCheck" />
                <label for="patchTextCheck">Update Title</label>
              </div>
              <input type="text" id="patchText" placeholder="Enter new text" />
            </div>
            <div class="form-group">
              <div class="checkbox-group">
                <input type="checkbox" id="patchCompletedCheck" />
                <label for="patchCompletedCheck">Update Completed</label>
              </div>
              <select id="patchCompleted">
                <option value="true">Completed</option>
                <option value="false">Pending</option>
              </select>
            </div>
            <button class="btn-info" onclick="updateTodoPartial()">
              üîß Partial Update
            </button>
          </div>

          <div class="api-group">
            <h3>Delete Todo</h3>
            <div class="form-group">
              <label>Todo ID:</label>
              <input
                type="number"
                id="deleteId"
                placeholder="Enter todo ID to delete"
              />
            </div>
            <button class="btn-danger" onclick="deleteTodo()">
              üóëÔ∏è Delete Todo
            </button>
          </div>

          <div class="api-group">
            <h3>CORS Bypass Proxy</h3>
            <div class="form-group">
              <label>Target URL:</label>
              <input
                type="text"
                id="corsUrl"
                placeholder="e.g., https://jsonplaceholder.typicode.com/todos/1"
              />
            </div>
            <div class="form-group">
              <label>Method:</label>
              <select id="corsMethod">
                <option value="GET">GET</option>
                <option value="POST">POST</option>
              </select>
            </div>
            <div class="form-group">
              <label>Request Body (optional, for POST):</label>
              <textarea id="corsBody" placeholder='{"key": "value"}'></textarea>
            </div>
            <button class="btn-info" onclick="bypassCors()">
              üåê Fetch via Proxy
            </button>
            <p style="font-size: 12px; color: #666; margin-top: 10px">
              Examples: https://jsonplaceholder.typicode.com/todos/1 (GET) |
              https://httpbin.org/post (POST) | https://httpbin.org/html (GET)
            </p>
          </div>
        </div>

        <div class="section full-width">
          <div class="response-header">
            <h2>üì° API Response</h2>
            <button class="clear-btn" onclick="clearResponse()">Clear</button>
          </div>
          <div id="response">Waiting for API call...</div>
        </div>
      </div>
    </div>

    <script>
      const API_BASE = "http://localhost:3000";

      function displayResponse(data, status, url, method) {
        const responseDiv = document.getElementById("response");
        const timestamp = new Date().toLocaleString();
        const statusClass = status >= 200 && status < 300 ? "SUCCESS" : "ERROR";

        // N·∫øu data c√≥ content (HTML/text response), hi·ªÉn th·ªã d∆∞·ªõi d·∫°ng text
        let displayContent;
        if (data && data.content) {
          displayContent = `${data.message || "Response"}:\n\n${data.content}`;
        } else {
          displayContent = JSON.stringify(data, null, 2);
        }

        responseDiv.textContent = `
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
‚îÇ ${method} ${url}
‚îÇ Status: ${status} ${statusClass}
‚îÇ Time: ${timestamp}
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

${displayContent}

‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ`;
      }

      function displayError(error, url, method) {
        const responseDiv = document.getElementById("response");
        const timestamp = new Date().toLocaleString();

        responseDiv.innerHTML = `
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
‚îÇ ${method} ${url}
‚îÇ Status: ERROR
‚îÇ Time: ${timestamp}
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

‚ùå Error: ${error.message}

${error.stack || ""}

‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ`;
      }

      function clearResponse() {
        document.getElementById("response").innerHTML =
          "Waiting for API call...";
      }

      async function apiCall(endpoint, method = "GET", body = null) {
        try {
          const url = `${API_BASE}${endpoint}`;
          const options = {
            method,
            headers: {
              "Content-Type": "application/json",
            },
          };

          if (body) {
            options.body = JSON.stringify(body);
          }

          const response = await fetch(url, options);
          const contentType = response.headers.get("content-type");
          let data;

          // Ki·ªÉm tra content-type tr∆∞·ªõc khi ƒë·ªçc body
          if (contentType && contentType.includes("application/json")) {
            data = await response.json();
          } else {
            // ƒê·ªçc text cho HTML ho·∫∑c plain text
            const text = await response.text();
            data = {
              message: `Response (${contentType || "unknown type"})`,
              content: text,
            };
          }

          displayResponse(data, response.status, url, method);

          return data;
        } catch (error) {
          displayError(error, `${API_BASE}${endpoint}`, method);
        }
      }

      async function getAllTodos() {
        const data = await apiCall("/todos", "GET");
        if (data && data.data) {
          renderTodoList(data.data);
        }
      }

      async function getTodoById() {
        const id = document.getElementById("getTodoId").value;
        if (!id) {
          alert("Please enter a todo ID");
          return;
        }
        await apiCall(`/todos/${id}`, "GET");
      }

      async function createTodo() {
        const text = document.getElementById("createText").value;
        const completed = document.getElementById("createCompleted").checked;

        if (!text) {
          alert("Please enter todo text");
          return;
        }

        await apiCall("/todos", "POST", { text, completed });
        document.getElementById("createText").value = "";
        document.getElementById("createCompleted").checked = false;
      }

      async function updateTodoFull() {
        const id = document.getElementById("putId").value;
        const text = document.getElementById("putText").value;
        const completed =
          document.getElementById("putCompleted").value === "true";

        if (!id || !text) {
          alert("Please enter both ID and text");
          return;
        }

        await apiCall(`/todos/${id}`, "PUT", { text, completed });
        document.getElementById("putId").value = "";
        document.getElementById("putText").value = "";
        document.getElementById("putCompleted").value = "false";
      }

      async function updateTodoPartial() {
        const id = document.getElementById("patchId").value;
        const updateText = document.getElementById("patchTextCheck").checked;
        const updateCompleted = document.getElementById(
          "patchCompletedCheck"
        ).checked;
        const text = document.getElementById("patchText").value;
        const completed =
          document.getElementById("patchCompleted").value === "true";

        if (!id) {
          alert("Please enter todo ID");
          return;
        }

        if (!updateText && !updateCompleted) {
          alert("Please select at least one field to update");
          return;
        }

        const data = {};
        if (updateText) {
          if (!text.trim()) {
            alert("Please enter text to update");
            return;
          }
          data.text = text;
        }
        if (updateCompleted) {
          data.completed = completed; // true = complete, false = pending
        }

        await apiCall(`/todos/${id}`, "PATCH", data);
        document.getElementById("patchTextCheck").checked = false;
        document.getElementById("patchText").value = "";
        document.getElementById("patchCompletedCheck").checked = false;
        document.getElementById("patchCompleted").value = "false";
      }

      async function deleteTodo() {
        const id = document.getElementById("deleteId").value;
        if (!id) {
          alert("Please enter a todo ID");
          return;
        }

        if (confirm(`Are you sure you want to delete todo #${id}?`)) {
          await apiCall(`/todos/${id}`, "DELETE");
        }
      }

      async function bypassCors() {
        const targetUrl = document.getElementById("corsUrl").value;
        const method = document.getElementById("corsMethod").value;
        const body = document.getElementById("corsBody").value;

        if (!targetUrl) {
          alert("Please enter a target URL");
          return;
        }

        let requestBody = null;
        if (body.trim()) {
          try {
            requestBody = JSON.parse(body);
          } catch (error) {
            alert("Invalid JSON in request body");
            return;
          }
        }

        await apiCall(
          `/bypass-cors/${encodeURIComponent(targetUrl)}`,
          method,
          requestBody
        );
      }

      function renderTodoList(todos) {
        const todoListDiv = document.getElementById("todoList");

        if (!todos || todos.length === 0) {
          todoListDiv.innerHTML =
            '<p style="text-align: center; color: #999; padding: 20px;">No todos found</p>';
          return;
        }

        todoListDiv.innerHTML = `
                <h3 style="margin-top: 20px; margin-bottom: 15px;">Current Todos (${
                  todos.length
                })</h3>
                ${todos
                  .map(
                    (todo) => `
                    <div class="todo-item ${todo.completed ? "completed" : ""}">
                        <div class="todo-text">
                            <strong>#${todo.id}</strong> ${todo.text}
                            <span class="status-badge ${
                              todo.completed ? "status-success" : "status-error"
                            }">
                                ${todo.completed ? "‚úì Done" : "‚óã Pending"}
                            </span>
                        </div>
                        <div class="todo-actions">
                            <button class="btn-warning" onclick="quickEdit(${
                              todo.id
                            }, '${todo.text.replace(/'/g, "\\'")}', ${
                      todo.completed
                    })">Edit</button>
                            <button class="btn-danger" onclick="quickDelete(${
                              todo.id
                            })">Delete</button>
                        </div>
                    </div>
                `
                  )
                  .join("")}
            `;
      }

      function quickEdit(id, text, completed) {
        document.getElementById("patchId").value = id;
        document.getElementById("patchTextCheck").checked = true;
        document.getElementById("patchText").value = text;
        document.getElementById("patchCompletedCheck").checked = true;
        document.getElementById("patchCompleted").value = completed
          ? "true"
          : "false";
        window.scrollTo({
          top: document.querySelector(".section:nth-child(2)").offsetTop - 20,
          behavior: "smooth",
        });
      }

      async function quickDelete(id) {
        if (confirm(`Delete todo #${id}?`)) {
          await apiCall(`/todos/${id}`, "DELETE");
        }
      }

      window.onload = function () {
        getAllTodos();
      };
    </script>
  </body>
</html>
